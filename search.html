<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Loading... - ASTiW</title>
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="themes/dark.css" id="themer">
	<script src="script.js"></script>
	<script>
		var nores = false;
		var term;
		
		function importantLoad() {
			var temp = getAllUrlParams().q;
			if (isSet(temp)) {
				term = decodeURIComponent(temp);
			} else {
				term = '';
			}
			document.getElementById('search').value = term;
			if (isSet(term)) {
				document.title = '"' + term + '" - Search Results - ASTiW';
			} else {
				document.title = 'Search - ASTiW';
			}
		};
		
		function load() {
			if (isSet(term)) {
				document.getElementById('nameThing').innerHTML = 'Search results for "' + term.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '"';
				var jsonurl = 'https://api.stibarc.gq/postsearch.sjs?q=' + encodeURIComponent(term);
				var r = new XMLHttpRequest();
				var ru = new XMLHttpRequest();
				r.addEventListener('load', function() {
					var stuf = r.responseText.split('\n');
					if (isSet(r.responseText) && stuf[0] != 'No results') {
						stuf.splice(stuf.length - 1, 1);
						stuf.reverse();
						for (i = 0; i < stuf.length; i++) {
							addRecent(stuf[i], i == 0);
						}
					} else {
						nores = true;
					}
					var jsonurlu = 'https://api.stibarc.gq/getuser.sjs?id=' + encodeURIComponent(term);
					ru.open('get', jsonurlu, true);
					ru.send();
				});
				ru.addEventListener('load', function() {
					var messenge = document.getElementById('messenge');
					if (isSet(ru.responseText)) {
						messenge.innerHTML = 'There is a user named <a class="classic" href="user.html?id=' + encodeURIComponent(term) + '">' + term.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</a>'
						document.getElementById('info').style.display = '';
					} else if (nores) {
						messenge.innerHTML = 'There are no results';
						messenge.style.color = 'var(--border)';
						messenge.style.textAlign = 'center';
						document.getElementById('info').style.display = '';
					}
					document.getElementById('rm').removeChild(document.getElementById('loader'));
					document.getElementById('nameThing').style.display = '';
					document.getElementById('main').style.display = '';
				});
				r.addEventListener('error', function() {alert('Could not connect to STiBaRC, please reload the page and try again')});
				ru.addEventListener('error', function() {alert('Could not connect to STiBaRC, please reload the page and try again')});
				r.open('get', jsonurl, true);
				r.send();
			} else {
				document.getElementById('nameThing').innerHTML = 'Search';
				document.getElementById('rm').removeChild(document.getElementById('loader'));
				var messenge = document.getElementById('messenge');
				messenge.innerHTML = 'Enter text into the search bar to search';
				messenge.style.color = 'var(--border)';
				messenge.style.textAlign = 'center';
				document.getElementById('nameThing').style.display = '';
				document.getElementById('info').style.display = '';
			}
		};
	</script>
</head>
<body>
	<nav><a id="title" href="index.html">ASTiW</a><input type="search" id="search" class="txf" placeholder="Search"><a href="messenger.html" class="mi ib">&#x1f4ac;&#xfe0e;</a><a href="newpost.html" class="mi ib">+</a><a href="settings.html" class="mi">&#8943;</a><a href="javascript:openUserMenu();" id="usermenu" class="mi ib rightmost"></a><a href="register.html" class="lb" id="register">REGISTER</a><a href="login.html" class="lb rightmost">LOG IN</a></nav>
	<div id="cssshade"></div>
	<div class="dbg" id="usermenubox">
		<div class="dialog">
			<a href="javascript:closeUserMenu();" class="closeButton">&times;</a>
			<h3 id="currentUserName"></h3>
			<div style="margin-top:16px;"><a class="othbut" id="userMenuProfButton" style="margin-right:8px;">View profile</a><a class="othbut noanon" href="editprofile.html">Edit profile</a></div>
			<p style="margin:8px 0;"><a class="classic noanon" href="changepassword.html">Change password</a></p>
			<p style="margin:8px 0;"><a class="classic noanon" href="mailto:herronjo110@gmail.com?subject=STiBaRC%20User%20Verification%20Request">Request user verification</a></p>
			<hr style="margin:20px 0;">
			<div id="accountSwitcher" style="display:none;">
				<h4 style="margin-top:20px;">Switch account</h4>
				<ul style="padding:0 0 0 20px;" id="accounts">
				</ul>
				<hr style="margin:20px 0;">
			</div>
			<div style="margin-top:16px;"><a class="othbut" href="login.html" style="margin-right:8px;">Add account</a><a class="othbut" href="javascript:logoutCurrentUser();" id="lobut">Log out</a></div>
			<p style="margin:8px 0;"><a class="classic" href="register.html">Register a new account</a></p>
		</div>
	</div>
	<main id="rm">
		<h3 id="nameThing" style="display:none;">Search results</h3>
		<div id="info" class="stdc" style="display:none; margin-bottom:24px;"><p id="messenge"></p></div>
		<div id="main" style="display:none;"></div>
		<div class="loader" id="loader"></div>
	</main>
</body>
</html>