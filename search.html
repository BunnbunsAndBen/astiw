<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Search Results - ASTiW</title>
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="dark.css" id="themer">
	<script src="script.js"></script>
	<script>
		var nores = false;
		var term;
		
		function addRecent(item, b) {
			var i = item.indexOf(':');
			var splits = [item.slice(0, i), item.slice(i + 1)];
			var main = document.getElementById('main');
			var el = document.createElement('a');
			el.href = 'post.html?id=' + splits[0];
			el.className = 'recentLinks';
			if (b) {
				el.innerHTML = '<div class="recent bb"><b>' + splits[1].replace(/</g, '&lt;').replace(/>/g, '&gt;') +'</b></div>'
			} else {
				el.innerHTML = '<div class="recent"><b>' + splits[1].replace(/</g, '&lt;').replace(/>/g, '&gt;') +'</b></div>'
			}
			main.appendChild(el);
		};
		
		function importantLoad() {
			term = decodeURIComponent(getAllUrlParams(window.location.href).q);
			document.getElementById('search').value = term;
			document.title = '"' + term + '" - Search Results - ASTiW';
		};
		
		function load() {
			document.getElementById('nameThing').innerHTML = 'Search results for "' + term + '"';
			var jsonurl = 'https://api.stibarc.gq/postsearch.sjs?q=' + term;
			var r = new XMLHttpRequest();
			var ru = new XMLHttpRequest();
			r.addEventListener('load', function() {
				var stuf = r.responseText.split('\n');
				if (isSet(r.responseText) && stuf[0] != 'No results') {
					stuf.splice(stuf.length - 1, 1);
					stuf.reverse();
					for (i = 0; i < stuf.length; i++) {
						addRecent(stuf[i], i == 0);
					}
				} else {
					nores = true;
				}
				var jsonurlu = 'https://api.stibarc.gq/getuser.sjs?id=' + term;
				ru.open('get', jsonurlu, true);
				ru.send();
			});
			ru.addEventListener('load', function() {
				var messenge = document.getElementById('messenge');
				if (isSet(ru.responseText)) {
					messenge.innerHTML = 'There is a user named <a class="classic" href="user.html?id=' + encodeURIComponent(term) + '">' + term + '</a>'
					document.getElementById('info').style.display = '';
				} else if (nores) {
					messenge.innerHTML = 'There are no results';
					messenge.style.color = 'var(--border)';
					messenge.style.textAlign = 'center';
					document.getElementById('info').style.display = '';
				}
				document.getElementById('rm').removeChild(document.getElementById('loader'));
				document.getElementById('nameThing').style.display = '';
				document.getElementById('main').style.display = '';
			});
			r.addEventListener('error', function() {alert('Please connect to the internet and reload the page')});
			ru.addEventListener('error', function() {alert('Please connect to the internet and reload the page')});
			r.open('get', jsonurl, true);
			r.send();
		};
	</script>
</head>
<body>
	<nav><a id="title" href="index.html">ASTiW</a><input type="search" id="search" class="txf" placeholder="Search"><a href="newpost.html" class="mi ib">+</a><a href="javascript:openMenu();" class="mi">&#8943;</a><a href="javascript:openUserMenu();" id="usermenu" class="mi ib rightmost"></a><a href="register.html" class="lb" id="register">REGISTER</a><a href="login.html" class="lb rightmost">LOG IN</a></nav>
	<div class="dbg" id="usermenubox">
		<div class="dialog">
			<a href="javascript:closeUserMenu();" class="closeButton">&times;</a>
			<h3>Account menu</h3>
			<div style="margin-top:16px;"><a class="othbut" id="userMenuProfButton">View profile</a></div>
			<!-- <div style="margin-top:16px;"><a class="othbut" href="editprofile.html">Edit profile</a></div>
			--><p><a class="classic" href="changepassword.html">Change password</a></p>
			<p>Use official STiBaRC software, such as the <a href="https://stibarc.gq/" class="classic">STiBaRC website</a>, to edit your profile</p>
			<p><a class="classic" href="mailto:herronjo110@gmail.com?subject=STiBaRC%20User%20Verification%20Request">Request user verification</a></p>
			<h4>Switch account</h4>
			<ul style="padding:0 0 0 20px;" id="accounts">
			</ul>
			<div style="margin-top:16px;"><a class="othbut" href="login.html">Add account</a></div>
			<div style="margin-top:16px;"><a class="othbut" href="logout.html">Log out</a></div>
			<p><a class="classic" href="register.html">Register a new account</a></p>
		</div>
	</div>
	<div class="dbg" id="menubox">
		<div class="dialog">
			<a href="javascript:closeMenu();" class="closeButton">&times;</a>
			<h3>ASTiW settings</h3>
			<h4 style="margin-bottom:calc(1.33em - 16px);">Toggles</h4>
			<div><button class="othbut" onclick="toggleSetting('dir');" id="toggleDir" style="margin-right:8px; margin-top:16px;">Default comment order: [value]</button><button class="othbut" onclick="toggleSetting('roi');" id="toggleROI" style="margin-top:16px;">Requests on intervals: [value]</button></div>
			<p class="small"><a href="javascript:explanation();" class="classic">What is requests on intervals</a></p>
			<p class="small">Settings may require a reload to take effect</p>
			<h4 style="margin-bottom:calc(1.33em - 16px);">Change theme (not fully functional)</h4>
			<div><button class="othbut" onclick="chtheme('dark');" style="margin-right:8px; margin-top:16px;">Dark (default)</button><button class="othbut" onclick="chtheme('light');" style="margin-right:8px; margin-top:16px;">Light</button><button class="othbut" onclick="chtheme('stibarc');" style="margin-top:16px;">STiBaRC</button></div>
			<h4>Clear data</h4>
			<p>If something isn't working correctly you can <a href="javascript:clearData();" class="classic">clear data</a>. (This will not log out your sess(es))</p>
			<h4>About</h4>
			<p>Created by savaka<br/>
			Based on the <a href="https://stibarc.gq/" target="_blank" class="classic">STiBaRC website</a></p>
			<p>ASTiW connects to the STiBaRC service; by using it you accept the STiBaRC <a href="https://stibarc.gq/privacy.html" target="_blank" class="classic">Privacy Policy</a></p>
		</div>
	</div>
	<main id="rm">
		<h3 id="nameThing" style="display:none;">Search results</h3>
		<div id="info" class="stdc" style="display:none; margin-bottom:24px;"><p id="messenge"></p></div>
		<div id="main" style="display:none;"></div>
		<div class="loader" id="loader"></div>
	</main>
</body>
</html>