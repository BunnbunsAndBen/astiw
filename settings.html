<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Settings - ASTiW</title>
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="themes/dark.css" id="themer">
	<script src="script.js"></script>
	<script>
		var loggedin;
		
		function load() {
			loggedin = isSet(localStorage.getItem('astiw_sesses')) && JSON.parse(localStorage.getItem('astiw_sesses')).length > 0;
			checkSettings();
			document.getElementById('rm').removeChild(document.getElementById('loader'));
			document.getElementById('eugh').style.display = '';
			document.getElementById('main').style.display = '';
		};
		
		function clearData() {
			if (confirm('Are you sure you want to clear local storage? This includes all signed in accounts, settings, read markings, and cached images')) {
				localStorage.clear();
				window.location.href = 'index.html';
			}
		};
		
		function markAllRead() {
			if (confirm('Are you sure you want to mark all posts read? You cannot undo this, except by clearing all data')) {
				document.getElementById('markallread').style.display = 'none';
				var r = new XMLHttpRequest();
				var ldr = document.createElement('div');
				ldr.className = 'loader';
				ldr.id = 'loader2';
				ldr.style.margin = '0';
				document.getElementById('marContain').appendChild(ldr);
				r.addEventListener('load', function() {
					var theimportantpart = r.responseText.split("\n")[0].split(':')[0];
					for (elbow = 1; elbow <= theimportantpart; elbow++) {
						localStorage.setItem('astiw_viewed' + elbow, 'true');
					}
					document.getElementById('marContain').removeChild(document.getElementById('loader2'));
					document.getElementById('markallread').style.display = 'initial';
				});
				r.addEventListener('error', function() {alert('Please connect to the internet and reload the page')});
				r.open('get', 'https://api.stibarc.gq/getposts.sjs', true);
				r.send();
			}
		};
		
		function toggleSetting(setting) {
			var bool = localStorage.getItem('astiw_' + setting) == 'true';
			localStorage.setItem('astiw_' + setting, (!bool).toString());
			checkSettings();
		};
		
		function applySetting(setting) {
			localStorage.setItem('astiw_' + setting, document.getElementById(setting).value);
			checkSettings();
		};
		
		function checkSettings() {
			var dir = localStorage.getItem('astiw_dir') == 'true';
			var roi = localStorage.getItem('astiw_roi') == 'true';
			var docache = localStorage.getItem('astiw_docache') == 'true';
			var replacesl = localStorage.getItem('astiw_replacesl') == 'true';
			var markread = localStorage.getItem('astiw_markread') == 'true';
			var theme = localStorage.getItem('astiw_theme');
			if (!isSet(theme)) {
				theme = 'dark.css';
			}
			var customtheme = localStorage.getItem('astiw_customtheme');
			if (!isSet(customtheme)) {
				customtheme = '';
			}
			document.getElementById('dir').value = dir;
			document.getElementById('roi').innerHTML = (!roi ? '&#x2714;&#xFE0E;' : '');
			document.getElementById('roi').style.backgroundColor = (!roi ? 'var(--probably-same-as-link)' : 'var(--cb-off)');
			document.getElementById('docache').innerHTML = (!docache ? '&#x2714;&#xFE0E;' : '');
			document.getElementById('docache').style.backgroundColor = (!docache ? 'var(--probably-same-as-link)' : 'var(--cb-off)');
			document.getElementById('markread').innerHTML = (!markread ? '&#x2714;&#xFE0E;' : '');
			document.getElementById('markread').style.backgroundColor = (!markread ? 'var(--probably-same-as-link)' : 'var(--cb-off)');
			document.getElementById('replacesl').innerHTML = (replacesl ? '&#x2714;&#xFE0E;' : '');
			document.getElementById('replacesl').style.backgroundColor = (replacesl ? 'var(--probably-same-as-link)' : 'var(--cb-off)');
			document.getElementById('theme').value = theme;
			document.getElementById('customtheme').value = customtheme;
			var mar = document.getElementById('markallread')
			if (markread) {
				mar.disabled = true;
				mar.className = 'othbut disabledbut';
			} else {
				mar.disabled = false;
				mar.className = 'othbut';
			}
		};
		
		function setCbAbility(id, bool) {
			var cbiq = document.getElementById(id)
			cbiq.disabled = !bool;
			cbiq.parentNode.style.opacity = (bool ? 1 : 0.5)
		};
	</script>
</head>
<body>
	<nav><a id="title" href="index.html">ASTiW</a><input type="search" id="search" class="txf" placeholder="Search"><a href="newpost.html" class="mi ib" style="color:var(--link);">+</a><a href="settings.html" class="mi">&#8943;</a><a href="javascript:openUserMenu();" id="usermenu" class="mi ib rightmost"></a><a href="register.html" class="lb" id="register">REGISTER</a><a href="login.html" class="lb rightmost">LOG IN</a></nav>
	<div id="cssshade"></div>
	<div class="dbg" id="usermenubox">
		<div class="dialog">
			<a href="javascript:closeUserMenu();" class="closeButton">&times;</a>
			<h3 id="currentUserName"></h3>
			<div style="margin-top:16px;"><a class="othbut" id="userMenuProfButton" style="margin-right:8px;">View profile</a><a class="othbut noanon" href="editprofile.html">Edit profile</a></div>
			<p style="margin:8px 0;"><a class="classic noanon" href="changepassword.html">Change password</a></p>
			<p style="margin:8px 0;"><a class="classic noanon" href="mailto:herronjo110@gmail.com?subject=STiBaRC%20User%20Verification%20Request">Request user verification</a></p>
			<hr style="margin:20px 0;">
			<div id="accountSwitcher" style="display:none;">
				<h4 style="margin-top:20px;">Switch account</h4>
				<ul style="padding:0 0 0 20px;" id="accounts">
				</ul>
				<hr style="margin:20px 0;">
			</div>
			<div style="margin-top:16px;"><a class="othbut" href="login.html" style="margin-right:8px;">Add account</a><a class="othbut" href="logout.html">Log out</a></div>
			<p style="margin:8px 0;"><a class="classic" href="register.html">Register a new account</a></p>
		</div>
	</div>
	<main id="rm">
		<h3 id="eugh" style="display:none;">Settings</h3>
		<div class="stdc" id="main" style="display:none;">
			<p>Settings are stored locally and only apply to this browser</p>
			<h4>Theme</h4>
			<div>
				<select id="theme" onchange="applySetting('theme'); colors();">
					<optgroup label="Standard">
						<option value="dark.css">Dark</option>
						<option value="amoled.css">Darker (AMOLED)</option>
						<option value="light.css">Light</option>
					</optgroup>
					<optgroup label="Misc.">
						<option value="stibarc.css">STiBaRC</option>
						<option value="pacer.css">Pacer</option>
					</optgroup>
					<optgroup label="Colors">
						<option value="red.css">Red</option>
						<option value="orange.css">Orange</option>
						<option value="yellow.css">Yellow</option>
						<option value="green.css">Green</option>
						<option value="blue.css">Blue</option>
						<option value="purple.css">Purple</option>
					</optgroup>
					<optgroup label="From URL">
						<option value="custom">Custom</option>
					</optgroup>
				</select>
				<p style="margin-bottom:9px;">Set theme</p>
				<p class="small">Change the colors of ASTiW</p>
				<p style="margin-bottom:9px;">Custom theme</p>
				<p class="small">Paste a URL of a custom theme (you must also choose "Custom" from the "Set theme" dropdown)</p>
				<input type="text" autocomplete="off" spellcheck="false" id="customtheme" class="txf" onchange="applySetting('customtheme'); colors();" placeholder="Custom theme URL" style="display:block; margin-bottom:16px;">
				<p style="margin-bottom:9px;"><a href="https://github.com/savaka2/astiw/wiki/Theme-Documentation" target="_blank" class="classic">Documentation</a></p>
				<p class="small">Learn how to create a custom theme</p>
			</div>
			<h4>Behavior</h4>
			<div>
				<select id="dir" onchange="applySetting('dir');">
					<option value="false">Newest first</option>
					<option value="true">Oldest first</option>
				</select>
				<p style="margin-bottom:9px;">Default comment order</p>
				<p class="small">Post pages load with comments in this order</p>
			</div>
			<div>
				<button class="cb" id="replacesl" onclick="toggleSetting('replacesl');"></button><p style="margin-bottom:9px;">Replace STiBaRC links with ASTiW links</p>
				<p class="small">Replace user-created links to STiBaRC content on the STiBaRC website with links to the same content on ASTiW</p>
			</div>
			<div>
				<button class="cb" id="markread" onclick="toggleSetting('markread');"></button><p style="margin-bottom:9px;">Mark posts read</p>
				<p class="small">Display titles of posts that have been viewed with lower opacity in lists</p>
			</div>
			<div id="marContain" style="margin-top:16px;">
				<button class="othbut" id="markallread" onclick="markAllRead();">Mark all posts read</button>
			</div>
			<div>
				<button class="cb" id="roi" onclick="toggleSetting('roi');"></button><p style="margin-bottom:9px;">Repeating requests</p>
				<p class="small">Home and post pages will check for new content every 0.5 seconds</p>
			</div>
			<div>
				<button class="cb" id="docache" onclick="toggleSetting('docache');"></button><p style="margin-bottom:9px;">Cache images</p>
				<p class="small">Save images to your browser to not have to load them again (turning this off does not delete already cached images)</p>
			</div>
			<h4>Extras</h4>
			<p style="margin-bottom:9px;">Bookmarklet: <a class="classic" href="javascript:(function()%7Bvar%20cpURL%20%3D%20window.location.href%3Bvar%20rptn%20%3D%20'bad'%3Bif%20(cpURL%20%3D%3D%20'https%3A%2F%2Fstibarc.gq%2F'%20%7C%7C%20cpURL%20%3D%3D%20'https%3A%2F%2Fstibarc.gq%2Findex.html')%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2F'%3B%7D%20else%20if%20(cpURL.indexOf('https%3A%2F%2Fstibarc.gq%2Fpost.html')%20%3D%3D%200)%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fpost.html'%20%2B%20cpURL.substring(28)%3B%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fstibarc.gq%2Fnewpost.html')%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fnewpost.html'%3B%7D%20else%20if%20(cpURL.indexOf('https%3A%2F%2Fstibarc.gq%2Feditprofile.sjs')%20%3D%3D%200)%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Feditprofile.html'%3B%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fstibarc.gq%2Fsearch.html')%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fsearch.html%3Fq%3D'%20%2B%20encodeURIComponent(document.getElementById('q').value)%3B%7D%20else%20if%20(cpURL.indexOf('https%3A%2F%2Fstibarc.gq%2Fuser.html')%20%3D%3D%200)%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fuser.html'%20%2B%20cpURL.substring(28)%3B%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fstibarc.gq%2Flogin.html')%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Flogin.html'%3B%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fstibarc.gq%2Fregister.html')%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fregister.html'%3B%7D%20else%20if%20(cpURL.indexOf('https%3A%2F%2Fstibarc.gq%2Fpasswd.sjs')%20%3D%3D%200)%20%7Brptn%20%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fchangepassword.html'%3B%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2F'%20%7C%7C%20cpURL%20%3D%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Findex.html')%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2F'%3B%7D%20else%20if%20(cpURL.indexOf('https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fpost.html')%20%3D%3D%200)%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2Fpost.html'%20%2B%20cpURL.substring(41)%3B%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fnewpost.html')%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2Fnewpost.html'%3B%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Feditprofile.html')%20%7Bif%20(confirm('Cannot%20switch%20in%20this%20direction%2C%20go%20to%20STiBaRC%20home%20page%3F'))%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2F'%3B%7D%7D%20else%20if%20(cpURL.indexOf('https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fsearch.html')%20%3D%3D%200)%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2Fsearch.html'%3B%7D%20else%20if%20(cpURL.indexOf('https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fuser.html')%20%3D%3D%200)%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2Fuser.html'%20%2B%20cpURL.substring(41)%3B%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Flogin.html')%20%7Bif%20(confirm('Target%20page%20may%20not%20be%20relevant%2C%20continue%20anyway%3F'))%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2Flogin.html'%3B%7D%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fregister.html')%20%7Bif%20(confirm('Target%20page%20may%20not%20be%20relevant%2C%20continue%20anyway%3F'))%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2Fregister.html'%3B%7D%7D%20else%20if%20(cpURL%20%3D%3D%20'https%3A%2F%2Fsavaka2.github.io%2Fastiw%2Fchangepassword.html')%20%7Bif%20(confirm('Cannot%20switch%20in%20this%20direction%2C%20go%20to%20STiBaRC%20home%20page%3F'))%20%7Brptn%20%3D%20'https%3A%2F%2Fstibarc.gq%2F'%3B%7D%7Dif%20(rptn%20!%3D%20'bad')%20%7Bwindow.location.href%20%3D%20rptn%3B%7D%7D)()">STiBaRC &#x21c4; ASTiW</a></p>
			<p class="small">Drag the link to your bookmarks bar to create a button to switch between the official STiBaRC website and ASTiW<br/>(Bookmarklets do not work on all browsers, but they do work on Chrome and Firefox)</p>
			<h4>Troubleshooting</h4>
			<p style="margin-bottom:9px;"><a href="javascript:clearData();" class="classic">Clear data</a></p>
			<p class="small">Use this to reset ASTiW if something isn't working (This will not log out your sess(es))</p>
			<p style="margin-bottom:9px;"><a href="https://github.com/savaka2/astiw/issues/new" class="classic" target="_blank">Submit issue</a></p>
			<p class="small">Report a bug (or suggest a feature) as an issue on GitHub</p>
			<h4>About</h4>
			<p>Created by savaka<br/>
			Based on the <a href="https://stibarc.gq/" target="_blank" class="classic">STiBaRC website</a></p>
			<p>ASTiW connects to the STiBaRC service; by using it you accept the STiBaRC <a href="https://stibarc.gq/privacy.html" target="_blank" class="classic">Privacy Policy</a></p>
		</div>
		<div class="loader" id="loader"></div>
	</main>
</body>
</html>